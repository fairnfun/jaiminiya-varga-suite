<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JaiminÄ«ya Varga Suite</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://unpkg.com/tesseract.js@4.0.1/dist/tesseract.min.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['"Playfair Display"', 'serif'],
            sans: ['Inter', 'sans-serif'],
          },
          colors: {
            vedic: {
              bg: '#F3EEE4',       
              dark: '#2D3243',     
              gold: '#B45309',     
              sacredRed: '#7F1D1D', 
              sacredYellow: '#D97706'
            }
          }
        }
      }
    }
  </script>
  <style>
    @media print { .no-print { display: none !important; } }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    
    .chart-gradient-border {
      padding: 6px;
      background: linear-gradient(135deg, #7F1D1D 0%, #D97706 50%, #7F1D1D 100%);
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(45, 50, 67, 0.15);
    }

    .loader { border-top-color: #B45309; animation: spinner 1.5s linear infinite; }
    @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-vedic-bg text-vedic-dark font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    const GRAHAS = [
      { id: 'asc', abbr: 'As', name: 'Ascendant', label: 'Ascendant' },
      { id: 'sun', abbr: 'Su', name: 'Sun', label: 'Sun' },
      { id: 'moon', abbr: 'Mo', name: 'Moon', label: 'Moon' },
      { id: 'mars', abbr: 'Ma', name: 'Mars', label: 'Mars' },
      { id: 'mercury', abbr: 'Me', name: 'Mercury', label: 'Mercury' },
      { id: 'jupiter', abbr: 'Ju', name: 'Jupiter', label: 'Jupiter' },
      { id: 'venus', abbr: 'Ve', name: 'Venus', label: 'Venus' },
      { id: 'saturn', abbr: 'Sa', name: 'Saturn', label: 'Saturn' },
      { id: 'rahu', abbr: 'Ra', name: 'Rahu', label: 'Rahu' },
      { id: 'ketu', abbr: 'Ke', name: 'Ketu', label: 'Ketu' },
    ];

    const NAVAMSA_1 = [[1,10,7,4,1,10,7,4,1,10,7,4],[2,9,8,3,2,9,8,3,2,9,8,3],[3,8,9,2,3,8,9,2,3,8,9,2],[4,7,10,1,4,7,10,1,4,7,10,1],[5,6,11,12,5,6,11,12,5,6,11,12],[6,5,12,11,6,5,12,11,6,5,12,11],[7,4,1,10,7,4,1,10,7,4,1,10],[8,3,2,9,8,3,2,9,8,3,2,9],[9,2,3,8,9,2,3,8,9,2,3,8]];
    const NAVAMSA_2 = [[1,5,9,1,5,9,1,5,9,1,5,9],[2,6,10,2,6,10,2,6,10,2,6,10],[3,7,11,3,7,11,3,7,11,3,7,11],[4,8,12,4,8,12,4,8,12,4,8,12],[5,9,1,5,9,1,5,9,1,5,9,1],[6,10,2,6,10,2,6,10,2,6,10,2],[7,11,3,7,11,3,7,11,3,7,11,3],[8,12,4,8,12,4,8,12,4,8,12,4],[9,1,5,9,1,5,9,1,5,9,1,5]];
    const DREKKANA_1 = [[1,4,7,10,1,1,7,10,1,1,7,10],[2,5,8,11,2,2,8,11,2,2,8,11],[3,6,9,12,3,3,9,12,3,3,9,12]];
    const DREKKANA_2 = [[1,12,4,9,7,6,10,3,1,12,4,9],[2,11,5,8,8,5,11,2,2,11,5,8],[3,10,6,7,9,4,12,1,3,10,6,7]];

    const toDecimal = (d, m, s) => (parseFloat(d)||0) + (parseFloat(m)||0)/60 + (parseFloat(s)||0)/3600;
    const getRasiNum = (deg) => Math.floor(((deg % 360) + 360) % 360 / 30) + 1;
    const getPosInRasi = (deg) => ((deg % 360) + 360) % 360 % 30;

    const SouthIndianChart = ({ title, subtitle, placements }) => {
      const chartOrder = [12, 1, 2, 3, 11, 'center', 4, 10, 'center_h', 5, 9, 8, 7, 6];
      return (
        <div className="chart-gradient-border">
          <div className="grid grid-cols-4 aspect-square bg-vedic-dark gap-[1px] rounded-[4px] overflow-hidden border-[1px] border-vedic-dark">
            {chartOrder.map((cell, idx) => {
              if (cell === 'center') {
                return (
                  <div key="center" className="col-span-2 row-span-2 flex flex-col items-center justify-center bg-vedic-bg p-2">
                    <span className="font-serif text-vedic-gold text-3xl md:text-4xl font-black tracking-widest leading-none">OM</span>
                    <h3 className="font-serif text-vedic-dark font-bold text-[10px] uppercase text-center leading-tight mt-2 tracking-wider">{title}</h3>
                    <p className="text-[8px] text-vedic-dark/60 font-sans uppercase italic text-center leading-none mt-1 tracking-tighter">{subtitle}</p>
                  </div>
                );
              }
              if (cell === 'center_h') return null;
              const grahasInCell = placements[cell] || [];
              return (
                <div key={cell} className="aspect-square flex flex-wrap content-center justify-center gap-1 p-1 bg-vedic-bg">
                  {grahasInCell.map(g => (
                    <span key={g} className={`text-[10px] font-bold px-1.5 py-0.5 rounded-sm shadow-sm ${g === 'As' ? 'bg-vedic-dark text-vedic-bg' : 'bg-white border border-vedic-dark/20 text-vedic-dark'}`}>
                      {g}
                    </span>
                  ))}
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const App = () => {
      const [positions, setPositions] = useState({
        asc: { deg: 0, min: 0, sec: 0 }, sun: { deg: 0, min: 0, sec: 0 }, moon: { deg: 0, min: 0, sec: 0 },
        mars: { deg: 0, min: 0, sec: 0 }, mercury: { deg: 0, min: 0, sec: 0 }, jupiter: { deg: 0, min: 0, sec: 0 },
        venus: { deg: 0, min: 0, sec: 0 }, saturn: { deg: 0, min: 0, sec: 0 }, rahu: { deg: 0, min: 0, sec: 0 }, ketu: { deg: 0, min: 0, sec: 0 }
      });
      const [loading, setLoading] = useState(false);

      const handleInputChange = (id, unit, val) => {
        setPositions(prev => {
          const newPos = { ...prev, [id]: { ...prev[id], [unit]: val } };
          if (id === 'rahu') {
            const decRahu = (toDecimal(newPos.rahu.deg, newPos.rahu.min, newPos.rahu.sec) + 180) % 360;
            newPos.ketu = { deg: Math.floor(decRahu), min: Math.floor((decRahu % 1) * 60), sec: Math.round(((decRahu % 1) * 60 % 1) * 60) };
          }
          return newPos;
        });
      };

      const handleImageUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        setLoading(true);
        try {
          const { data: { text } } = await Tesseract.recognize(file, 'eng');
          const newPositions = { ...positions };
          const regex = /(Ascendant|Sun|Moon|Mars|Mercury|Jupiter|Venus|Saturn|Rahu)\s+(\d+)Â°\s+(\d+)'\s+(\d+)"/gi;
          let match;
          while ((match = regex.exec(text)) !== null) {
            const label = match[1];
            const deg = match[2]; const min = match[3]; const sec = match[4];
            const graha = GRAHAS.find(g => g.label === label);
            if (graha) newPositions[graha.id] = { deg: parseInt(deg), min: parseInt(min), sec: parseInt(sec) };
          }
          const decRahu = (toDecimal(newPositions.rahu.deg, newPositions.rahu.min, newPositions.rahu.sec) + 180) % 360;
          newPositions.ketu = { deg: Math.floor(decRahu), min: Math.floor((decRahu % 1) * 60), sec: Math.round(((decRahu % 1) * 60 % 1) * 60) };
          setPositions(newPositions);
        } catch (err) { alert("OCR Fehler."); }
        setLoading(false);
      };

      const results = useMemo(() => {
        const res = {};
        GRAHAS.forEach(g => {
          const dec = toDecimal(positions[g.id].deg, positions[g.id].min, positions[g.id].sec);
          const rIdx = getRasiNum(dec) - 1; const pos = getPosInRasi(dec);
          const nIdx = Math.min(Math.floor(pos / 3.333333), 8); const dIdx = Math.min(Math.floor(pos / 10), 2);
          res[g.id] = { rasi: rIdx + 1, nav1: NAVAMSA_1[nIdx][rIdx], nav2: NAVAMSA_2[nIdx][rIdx], drek1: DREKKANA_1[dIdx][rIdx], drek2: DREKKANA_2[dIdx][rIdx] };
        });
        return res;
      }, [positions]);

      const getPlacements = (k) => {
        const p = {};
        Object.entries(results).forEach(([id, r]) => {
          const rasi = r[k]; const abbr = GRAHAS.find(g => g.id === id).abbr;
          if (!p[rasi]) p[rasi] = []; p[rasi].push(abbr);
        });
        return p;
      };

      return (
        <div className="max-w-6xl mx-auto px-4 py-12">
          <header className="text-center mb-16 no-print">
            <h1 className="font-serif text-3xl text-vedic-dark font-extrabold tracking-[0.2em] mb-8 uppercase">JaiminÄ«ya Varga Calculator</h1>
            <label className="cursor-pointer bg-vedic-dark text-vedic-bg px-6 py-3 rounded shadow hover:bg-vedic-dark/90 transition-all font-bold text-xs uppercase tracking-widest">
               ðŸ“· Upload Graha Screenshot
               <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} disabled={loading} />
            </label>
            {loading && <div className="loader mx-auto mt-4 rounded-full border-4 border-t-4 border-gray-200 h-8 w-8"></div>}
          </header>

          <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
            <div className="lg:col-span-4 space-y-3 no-print">
              <h2 className="font-serif text-lg font-bold text-vedic-dark mb-4 border-b border-vedic-dark/20 pb-2">Positions</h2>
              {GRAHAS.map(g => (
                <div key={g.id} className="bg-white/60 p-2 rounded flex justify-between items-center border border-vedic-dark/5">
                  <label className="font-serif text-[10px] font-bold text-vedic-dark uppercase w-20">{g.name}</label>
                  <div className="flex gap-1 flex-1">
                    {['deg','min','sec'].map(u => (
                      <input key={u} type="number" value={positions[g.id][u]} onChange={(e) => handleInputChange(g.id, u, e.target.value)} className="w-full text-center text-xs bg-transparent border-b border-vedic-dark/20 focus:border-vedic-gold outline-none py-1" />
                    ))}
                  </div>
                </div>
              ))}
            </div>

            <div className="lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-10">
              <SouthIndianChart title="NavÄá¹Å›a 1" subtitle="CÄrÄdi Guá¹‡a Navaka" placements={getPlacements('nav1')} />
              <SouthIndianChart title="NavÄá¹Å›a 2" subtitle="TrayÄgni Tattva Navaka" placements={getPlacements('nav2')} />
              <SouthIndianChart title="Drekkaá¹‡a 1" subtitle="Parivá¹›tti-Traya" placements={getPlacements('drek1')} />
              <SouthIndianChart title="Drekkaá¹‡a 2" subtitle="Krama-Vyutkrama" placements={getPlacements('drek2')} />
            </div>
          </div>
          
          <footer className="text-center mt-20 text-vedic-dark/40 font-serif text-xs uppercase tracking-widest no-print">
            JaiminÄ«ya Varga Suite â€¢ Vedic Excellence
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>